########################################################################################
#                                         											   #
# AVE MARIA events																	   #
# A Very Extensive Modification for Appropriate Realism and Improved Authenticity	   #
#                                         											   #
# ID AVE_MARIA_roman_administration.1 - AVE_MARIA_roman_administration.499			   #
#                               													   #
########################################################################################

# Written by Atreides

namespace = AVE_MARIA_roman_administration

##NOTES:
## QOL event in order not to change every single history file
## 
character_event = {
	id = AVE_MARIA_roman_administration.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_save_game = no
		primary_title = {
			OR = { 
				title = e_byzantium
				title = e_roman_empire
			}
			has_law = succ_byzantine_elective
		}
	}
	
	immediate = {
		
		# set_allow_title_revokation = no
		
		## 1066 start date - create specific titles and add specific titles to specific people
			
		# Remove vanilla ducal title holders and give them to civilian_theme_new_holder and create military theme titles for previous aristocrat
		any_title = {
			limit = {
				tier = DUKE
				NOT = { tier = KING	}
				NOT = { is_priest = yes }
				has_holder = yes	
				holder_scope = {			
					is_vassal_or_below_of = ROOT
					NOT = { character = ROOT }
				}
			}
			if = {					
				limit = {				
					has_holder = yes			
					holder_scope = {
						NOT = { tier = KING	}
						NOT = { is_priest = yes }
						is_vassal_or_below_of = ROOT
						is_adult = yes
					}
				}								
				holder_scope = {
					location = {				
						save_event_target_as = target_location_military_theme_capital			
					}
					if = { # Create the military theme title and family county titular title when holder has not already a county family title
						limit = {
							any_demesne_title = {
								has_title_flag = created_family_county_title
							}
						}
						create_random_steward = { # Create the new civilian_theme_new_holder	
							random_traits = yes		
							dynasty = random		
							female = no		
							attributes = {		
								diplomacy = 2	
								learning = 2	
								stewardship = 8	
								intrigue = 2	
								martial = 2	
							}		
						}			
						new_character = {			
							save_event_target_as = civilian_theme_new_holder		
							set_character_flag = civilian_theme_new_holder		
						}
						create_title = { # Create the military theme title and family county titular title	
							tier = DUKE		
							landless = yes		
							temporary = no		
							culture = greek		
							name = MILITARY_THEME_TITLE		
							holder = THIS		
							# graphical_culture = byzantinegfx		
							# capital = event_target:target_location_military_theme_capital		
							# base_title = PREV
							custom_created = yes
							ruler = "Strategos"		
							ruler_female = "Strategos"		
									
							# can_be_usurped = no		
							# duchy_revokation = no		
							# can_be_claimed = no		
							# assimilate = no		
						}
						new_title = { # MILITARY_THEME_TITLE
							set_title_flag = created_military_theme_title
							add_law = {		
								law = succ_byzantine_elective	
								cooldown = no 	
								opinion_effect = no	
							}		
							add_law = {		
								law = agnatic_succession	
								cooldown = no 	
								opinion_effect = no	
							}
						}
						any_title_under = { # Give the civilian_theme_new_holder all the previous holder titles except the newly created military and family titles
							limit = {			
								NOT = { 
									tier = baron 
									OR = {
										has_title_flag = created_family_county_title
										has_title_flag = created_military_theme_title
										has_title_flag = roman_administration_tagma_title
										has_title_flag = roman_administration_domestikos_east_title
										has_title_flag = roman_administration_domestikos_west_title
									}
								}		
							}			
							gain_title = event_target:civilian_theme_new_holder			
						}
						gain_title = event_target:civilian_theme_new_holder
						event_target:civilian_theme_new_holder = { # Create the military thematic relationship otherwise you are fucking lost
							make_tributary = {
								who = PREV
								tributary_type = theme_military
							}
						}
					}
					else = { # Create the military theme title only, if the family county titular title has already been created
						create_random_steward = {			
							random_traits = yes		
							dynasty = random		
							female = no		
							attributes = {		
								diplomacy = 2	
								learning = 2	
								stewardship = 8	
								intrigue = 2	
								martial = 2	
							}		
						}			
						new_character = {			
							save_event_target_as = civilian_theme_new_holder		
							set_character_flag = civilian_theme_new_holder		
						}
						create_title = {			
							tier = DUKE		
							landless = yes		
							temporary = no		
							culture = greek		
							name = MILITARY_THEME_TITLE		
							holder = THIS		
							# graphical_culture = byzantinegfx		
							# capital = event_target:target_location_military_theme_capital		
									
							ruler = "Strategos"		
							ruler_female = "Strategos"		
									
							# can_be_usurped = no		
							# duchy_revokation = no		
							# can_be_claimed = no		
							# assimilate = no		
						}
						new_title = {
							set_title_flag = created_military_theme_title
							add_law = {		
								law = succ_byzantine_elective	
								cooldown = no 	
								opinion_effect = no	
							}		
							add_law = {		
								law = agnatic_succession	
								cooldown = no 	
								opinion_effect = no	
							}
						}
						create_title = {			
							tier = COUNT		
							landless = yes		
							temporary = no		
							culture = greek		
							name = FAMILY_COUNT_TITLE		
							holder = THIS		
							# graphical_culture = byzantinegfx		
							# capital = 496		
									
							ruler = "Eugeneios"		
							ruler_female = "Eugeneia"		
									
							# can_be_usurped = no		
							# duchy_revokation = no		
							# can_be_claimed = no		
							# assimilate = no		
						}			
						new_title = {
							set_title_flag = created_family_county_title
							add_law = {		
								law = succ_byzantine_elective	
								cooldown = no 	
								opinion_effect = no	
							}		
							add_law = {		
								law = agnatic_succession	
								cooldown = no 	
								opinion_effect = no	
							}		
						}				
						any_title_under = {				
							limit = {			
								NOT = { 
									tier = baron 
									OR = {
										has_title_flag = created_family_county_title
										has_title_flag = created_military_theme_title
										has_title_flag = roman_administration_tagma_title
										has_title_flag = roman_administration_domestikos_east_title
										has_title_flag = roman_administration_domestikos_west_title
									}
								}		
							}			
							gain_title = event_target:civilian_theme_new_holder			
						}
						gain_title = event_target:civilian_theme_new_holder
						event_target:civilian_theme_new_holder = {
							make_tributary = {
								who = PREV
								tributary_type = theme_military
							}
						}
					}
					
				}
				set_title_flag = roman_administration_civilian_theme
				add_law = {		
					law = succ_byzantine_elective	
					cooldown = no 	
					opinion_effect = no	
				}		
				add_law = {		
					law = agnatic_succession	
					cooldown = no 	
					opinion_effect = no	
				}
			}					
			if = {
				limit = {
					has_holder = yes			
					holder_scope = {
						NOT = { tier = KING }
						NOT = { is_priest = yes }
						is_vassal_or_below_of = ROOT	
						is_adult = no
					}
				}
				holder_scope = {
					# create_random_soldier = {			
						# random_traits = yes		
						# dynasty = random		
						# female = no		
						# attributes = {		
							# diplomacy = 2	
							# learning = 2	
							# stewardship = 2	
							# intrigue = 2	
							# martial = 8	
						# }		
					# }		
					spawn_great_commander = yes
					new_character = {			
						save_event_target_as = military_theme_new_holder		
						set_character_flag = military_theme_new_holder		
					}
					create_random_steward = {			
						random_traits = yes		
						dynasty = random		
						female = no		
						attributes = {		
							diplomacy = 2	
							learning = 2	
							stewardship = 8	
							intrigue = 2	
							martial = 2	
						}		
					}			
					new_character = {			
						save_event_target_as = civilian_theme_new_holder		
						set_character_flag = civilian_theme_new_holder		
					}
					location = {				
						save_event_target_as = target_location_military_theme_capital			
					}
					create_title = {			
						tier = DUKE		
						landless = yes		
						temporary = no		
						culture = greek		
						name = MILITARY_THEME_TITLE		
						holder = event_target:military_theme_new_holder		
						# graphical_culture = byzantinegfx		
						# capital = event_target:target_location_military_theme_capital		
								
						ruler = "Strategos"		
						ruler_female = "Strategos"		
								
						# can_be_usurped = no		
						# duchy_revokation = no		
						# can_be_claimed = no		
						# assimilate = no		
					}
					new_title = {
						set_title_flag = created_military_theme_title
						add_law = {		
							law = succ_byzantine_elective	
							cooldown = no 	
							opinion_effect = no	
						}		
						add_law = {		
							law = agnatic_succession	
							cooldown = no 	
							opinion_effect = no	
						}
						gain_title = event_target:military_theme_new_holder
					}
					any_title_under = {				
						limit = {			
							NOT = { 
								tier = baron 
								OR = {
									has_title_flag = created_family_county_title
									has_title_flag = created_military_theme_title
									has_title_flag = roman_administration_tagma_title
									has_title_flag = roman_administration_domestikos_east_title
									has_title_flag = roman_administration_domestikos_west_title
								}
							}		
						}			
						gain_title = event_target:civilian_theme_new_holder
						event_target:civilian_theme_new_holder = {
							make_tributary = {
								who = event_target:military_theme_new_holder
								tributary_type = theme_military
							}
						}
					}
				}
				set_title_flag = roman_administration_civilian_theme
				add_law = {		
					law = succ_byzantine_elective	
					cooldown = no 	
					opinion_effect = no	
				}		
				add_law = {		
					law = agnatic_succession	
					cooldown = no 	
					opinion_effect = no	
				}
			}
			
		}
		
		# Swap civilian_theme_new_holder to update government
		any_title = {
			limit = {
				has_title_flag = roman_administration_civilian_theme
			}
			holder_scope = {
				clr_character_flag = civilian_theme_new_holder
				clear_event_target = civilian_theme_new_holder
				create_random_steward = {			
					random_traits = yes		
					dynasty = random		
					female = no		
					attributes = {		
						diplomacy = 2	
						learning = 2	
						stewardship = 8	
						intrigue = 2	
						martial = 2	
					}		
				}			
				new_character = {
					add_hexaco_education_traits = yes
					save_event_target_as = civilian_theme_new_holder		
					set_character_flag = civilian_theme_new_holder		
				}
				any_demesne_title = {
					gain_title = event_target:civilian_theme_new_holder
				}
			}
		}
		
		# Destroy duplicate family ducal titles and give it to the oldest of the dynasty
		
	}	

}

## Create the tagma armies
character_event = {
	id = AVE_MARIA_roman_administration.2
	hide_window = yes
	
	is_triggered_only = yes
		
	trigger = {
		is_save_game = no
		primary_title = {
			OR = { 
				title = e_byzantium
				title = e_roman_empire
			}
			has_law = succ_byzantine_elective
		}
	}
	
	immediate = {
		spawn_great_commander_effect = yes
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = {
			create_title = { #Scholai
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Scholae Palatinae"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Domestikos"
				ruler_female = "Domestikos"
				foa = "My Domestikos"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_regular_cavalry_tagma = yes
				}
			}
		}
		
		spawn_great_commander_effect = yes
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = {
			create_title = { #Excubitor
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Excubitores"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Domestikos"
				ruler_female = "Domestikos"
				foa = "My Domestikos"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_regular_cavalry_tagma = yes
				}
			}
		}
		
		spawn_great_commander_effect = yes
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = {
			create_title = { #Vigla
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Vigla"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Domestikos"
				ruler_female = "Domestikos"
				foa = "My Domestikos"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_regular_cavalry_tagma = yes
				}
			}
		}
		
		spawn_great_commander_effect = yes
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = {
			create_title = { #Hikanatoi
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Hikanatoi"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Domestikos"
				ruler_female = "Domestikos"
				foa = "My Domestikos"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_regular_cavalry_tagma = yes
				}
			}
		}
	
	}
}

character_event = {			
	id = AVE_MARIA_roman_administration.3
	border = GFX_event_normal_frame_diplomacy		
	desc = AVE_MARIA_roman_administration.3	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {		
		
	}		
	
}			
