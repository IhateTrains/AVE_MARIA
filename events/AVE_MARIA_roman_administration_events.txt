########################################################################################
#                                         											   #
# AVE MARIA events																	   #
# A Very Extensive Modification for Appropriate Realism and Improved Authenticity	   #
#                                         											   #
# ID AVE_MARIA_roman_administration.1 - AVE_MARIA_roman_administration.499			   #
#                               													   #
########################################################################################

# Written by Atreides

namespace = AVE_MARIA_roman_administration

##NOTES:
## QOL event in order not to change every single history file
## 
character_event = {
	id = AVE_MARIA_roman_administration.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_save_game = no
		primary_title = {
			OR = { 
				title = e_byzantium
				title = e_roman_empire
			}
			has_law = succ_byzantine_elective
		}
	}
	
	immediate = {
		
		k_abydos_theme = {	
			make_primary_title = yes
		}	
		k_thrace_theme = {	
			make_primary_title = yes
		}	
		k_strymon_theme = {	
			make_primary_title = yes
		}	
		k_thessalonika_theme = {	
			make_primary_title = yes
		}	
		k_neopatras_theme = {	
			make_primary_title = yes
		}	
		k_dyrrachion_theme = {	
			make_primary_title = yes
		}	
		k_epirus_theme = {	
			make_primary_title = yes
		}	
		k_cephalonia_theme = {	
			make_primary_title = yes
		}	
		k_athens_theme = {	
			make_primary_title = yes
		}	
		k_achaia_theme = {	
			make_primary_title = yes
		}	
		k_krete_theme = {	
			make_primary_title = yes
		}	
		k_paphlagonia_theme = {	
			make_primary_title = yes
		}	
		k_boukellarion_theme = {	
			make_primary_title = yes
		}	
		k_samos_theme = {	
			make_primary_title = yes
		}	
		k_thracesia_theme = {	
			make_primary_title = yes
		}	
		k_opsikon_theme = {	
			make_primary_title = yes
		}	
		k_optimatoi_theme = {	
			make_primary_title = yes
		}	
		k_cibyrrhaeot_theme = {	
			make_primary_title = yes
		}	
		k_charsianon_theme = {	
			make_primary_title = yes
		}	
		k_cappadocia_theme = {	
			make_primary_title = yes
		}	
		k_coloneia_theme = {	
			make_primary_title = yes
		}	
		k_sebasteia_theme = {	
			make_primary_title = yes
		}	
		k_lykandos_theme = {	
			make_primary_title = yes
		}	
		k_anatolia_theme = {	
			make_primary_title = yes
		}	
		k_melitene_theme = {	
			make_primary_title = yes
		}	
		k_cyprus_theme = {	
			make_primary_title = yes
		}	
		k_trebizond_theme = {	
			make_primary_title = yes
		}	
		k_cherson_theme = {	
			make_primary_title = yes
		}	
		k_armeniacon_theme = {	
			make_primary_title = yes
		}	
		k_armenia_minor_theme = {	
			make_primary_title = yes
		}	
		k_seleukeia_theme = {	
			make_primary_title = yes
		}	
		k_turnovo_theme = {	
			make_primary_title = yes
		}	
		k_karvuna_theme = {	
			make_primary_title = yes
		}	
		k_adrianopolis_theme = {	
			make_primary_title = yes
		}	
		k_vidin_theme = {	
			make_primary_title = yes
		}	
		k_ohrid_theme = {	
			make_primary_title = yes
		}	
		k_rashka_theme = {	
			make_primary_title = yes
		}	
		k_macva_theme = {	
			make_primary_title = yes
		}	
		k_hum_theme = {	
			make_primary_title = yes
		}	
		k_dioclea_theme = {	
			make_primary_title = yes
		}	
		k_ragusa_theme = {	
			make_primary_title = yes
		}	

		any_title = {
			limit = {
				roman_administration_theme_title_trigger = yes
				NOT = { holder = ROOT }
			}
			holder_scope = { # Creating the civilian theme new holder and the military theme new older if character is too young and give them the titles
				if = { #is_adult = yes
					limit = {
						is_adult = yes
					}
					save_event_target_as = military_theme_holder
					create_random_steward = {			
						random_traits = yes		
						dynasty = random		
						female = no		
						attributes = {		
							diplomacy = 2	
							learning = 2	
							stewardship = 8	
							intrigue = 2	
							martial = 2	
						}		
					}			
					new_character = {			
						save_event_target_as = civilian_theme_new_holder		
						set_character_flag = civilian_theme_new_holder		
					}
					any_title_under = { # Give to the civilian guy the vanilla ducal title and everything
						limit = {
							holder = event_target:military_theme_holder
							NOT = { 
								tier = baron 
								roman_administration_family_title_trigger = yes
								roman_adminisration_strategos_title_trigger = yes
							}		
						}			
						grant_title_no_opinion = event_target:civilian_theme_new_holder			
					}
					event_target:civilian_theme_new_holder = { # Create the military thematic relationship otherwise you are fucking lost - when vanilla ducal title holder was not underage
						make_tributary = {
							who = PREV
							tributary_type = theme_military
						}
					}					
				}				
				if = {
					limit = {
						is_adult = no
					}
					spawn_great_commander = yes
					new_character = {			
						save_event_target_as = military_theme_new_holder		
						set_character_flag = military_theme_new_holder		
					}
					create_random_steward = {			
						random_traits = yes		
						dynasty = random		
						female = no		
						attributes = {		
							diplomacy = 2	
							learning = 2	
							stewardship = 8	
							intrigue = 2	
							martial = 2	
						}		
					}			
					new_character = {			
						save_event_target_as = civilian_theme_new_holder		
						set_character_flag = civilian_theme_new_holder		
					}
					any_title_under = { # Give to the civilian guy the vanilla ducal title and everything
						limit = {
							holder = event_target:military_theme_holder
							NOT = { 
								tier = baron 
								roman_administration_family_title_trigger = yes
							}		
						}			
						grant_title_no_opinion = event_target:civilian_theme_new_holder			
					}
					event_target:civilian_theme_new_holder = { # Create the military thematic relationship otherwise you are fucking lost - when vanilla ducal title holder was underage
						make_tributary = { 
							who = event_target:military_theme_new_holder
							tributary_type = theme_military
						}
					}
				}
			}
		}
		
		# d_opsikon = {
			# holder_scope = { # Creating the civilian theme new holder and the military theme new older if character is too young and give them the titles
				# save_event_target_as = military_theme_holder
				# create_random_steward = {			
					# random_traits = yes		
					# dynasty = random		
					# female = no		
					# attributes = {		
						# diplomacy = 2	
						# learning = 2	
						# stewardship = 8	
						# intrigue = 2	
						# martial = 2	
					# }		
				# }			
				# new_character = {			
					# save_event_target_as = civilian_theme_new_holder		
					# set_character_flag = civilian_theme_new_holder		
				# }
				# any_title_under = { # Give to the civilian guy the vanilla ducal title and everything
					# limit = {
						# holder = event_target:military_theme_holder
						# NOT = { 
							# tier = baron 
							# OR = {
								# title = k_opsikon_theme
								# title = k_roman_family_1
							# }
						# }		
					# }			
					# grant_title_no_opinion = event_target:civilian_theme_new_holder			
				# }
				# if = { # Create the military thematic relationship otherwise you are fucking lost - when vanilla ducal title holder was not underage
					# limit = {
						# is_adult = yes
					# }
					# event_target:civilian_theme_new_holder = {
						# make_tributary = {
							# who = PREV
							# tributary_type = theme_military
						# }
					# }
					
				# }
				# if = { # Create the military thematic relationship otherwise you are fucking lost - when vanilla ducal title holder was underage
					# limit = {
						# is_adult = no
					# }
					# event_target:civilian_theme_new_holder = {
						# make_tributary = {
							# who = event_target:military_theme_new_holder
							# tributary_type = theme_military
						# }
					# }
				# }
			# }
		# }
			
	}	

}

## Create the tagma armies
character_event = {
	id = AVE_MARIA_roman_administration.2
	hide_window = yes
	
	is_triggered_only = yes
		
	trigger = {
		is_save_game = no
		primary_title = {
			OR = { 
				title = e_byzantium
				title = e_roman_empire
			}
			has_law = succ_byzantine_elective
		}
	}
	
	immediate = {
		spawn_great_commander_effect = yes # Create a tagma - spawn commander
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = { # Create a Tagma - Elite Tagma Scholai
			create_title = { #Scholai
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Scholae Palatinae"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Domestikos"
				ruler_female = "Domestikos"
				foa = "My Domestikos"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_elite_cavalry_tagma = yes
				}
			}
		}
		
		spawn_great_commander_effect = yes # Create a tagma - spawn commander
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = { # Create a Tagma - Elite Tagma Excubitor
			create_title = { #Excubitor
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Excubitores"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Archontes"
				ruler_female = "Archontes"
				foa = "My Archontes"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_elite_cavalry_tagma = yes
				}
			}
		}
		
		spawn_great_commander_effect = yes # Create a tagma - spawn commander
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = { # Create a Tagma - Elite Tagma Vigla/Arithmos
			create_title = { #Vigla/Arithmos
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Arithmos"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Archontes"
				ruler_female = "Archontes"
				foa = "My Archontes"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_elite_cavalry_tagma = yes
				}
			}
		}
		
		spawn_great_commander_effect = yes # Create a tagma - spawn commander
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = { # Create a Tagma - Elite Tagma Hikanatoi
			create_title = { #Hikanatoi
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Hikanatoi"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Archontes"
				ruler_female = "Archontes"
				foa = "My Archontes"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_elite_cavalry_tagma = yes
				}
			}
		}
		
		# Create a Tagma - Armeniakon 1000 men
		spawn_great_commander_effect = yes # Create a tagma - spawn commander
		new_character = { save_event_target_as = roman_administration_tagma_commander }
		e_byzantium = { # Create a Tagma - Regular tagma - Armeniakon
			create_title = { #Armeniakon
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Armeniakon"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Archontes"
				ruler_female = "Archontes"
				foa = "My Archontes"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_regular_infantry_taxiarchies_tagma = yes
				}
			}
		}
		
		
		# Create a Tagma - Anatolikon 3000 men ?
		e_byzantium = { # Create a Tagma - Regular tagma - Armeniakon
			create_title = { #Hikanatoi
				tier = DUKE
				landless = yes
				temporary = no
				rebel = no
				culture = ROOT
				name = "Anatolikon"
				holder = event_target:roman_administration_tagma_commander
				custom_created = yes
				base_title = THIS
				copy_title_laws = yes
				mercenary = no
				adventurer = no
				ruler = "Archontes"
				ruler_female = "Archontes"
				foa = "My Archontes"				
			}
			new_title = {
				set_title_flag = roman_administration_tagma_title
				holder_scope = {
					set_defacto_liege = ROOT
					save_event_target_as = target_tagma_commander
					roman_administration_create_elite_cavalry_tagma = yes
				}
			}
		}
		
		# Create a Tagma - Regular tagma - 
		# e_byzantium = { # Create a Tagma - Regular tagma - Armeniakon
			# create_title = { #Hikanatoi
				# tier = DUKE
				# landless = yes
				# temporary = no
				# rebel = no
				# culture = ROOT
				# name = "Hikanatoi"
				# holder = event_target:roman_administration_tagma_commander
				# custom_created = yes
				# base_title = THIS
				# copy_title_laws = yes
				# mercenary = no
				# adventurer = no
				# ruler = "Archontes"
				# ruler_female = "Archontes"
				# foa = "My Archontes"				
			# }
			# new_title = {
				# set_title_flag = roman_administration_tagma_title
				# holder_scope = {
					# set_defacto_liege = ROOT
					# save_event_target_as = target_tagma_commander
					# roman_administration_create_elite_cavalry_tagma = yes
				# }
			# }
		# }
		
		
		
		# Create a Tagma - Ethnarchoi tagma - 400 franks/normans
		
		if = { # Create a tagma - Varangian Guard
			limit = {
				has_global_flag = varangian_guard_founded
			}
			spawn_great_commander_effect = yes # Create a tagma - spawn commander
			new_character = { save_event_target_as = roman_administration_tagma_commander }
			e_byzantium = {
				create_title = { # Varangian Guard
					tier = DUKE
					landless = yes
					temporary = no
					rebel = no
					culture = ROOT
					name = "Varangian Guard"
					holder = event_target:roman_administration_tagma_commander
					custom_created = yes
					base_title = THIS
					copy_title_laws = yes
					mercenary = no
					adventurer = no
					ruler = "Archontes"
					ruler_female = "Archontes"
					foa = "My Archontes"				
				}
				new_title = {
					set_title_flag = roman_administration_tagma_title
					set_title_flag = varangian_guard
					holder_scope = {
						set_defacto_liege = ROOT
						save_event_target_as = target_tagma_commander
						roman_administration_create_varangian_tagma = yes
					}
				}
			}
		}
		
	}
}

## Join the Imperial Society
character_event = {	
	id = AVE_MARIA_roman_administration.3
	border = GFX_event_normal_frame_diplomacy		
	desc = AVE_MARIA_roman_administration.3	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_save_game = no
		primary_title = {
			OR = { 
				title = e_byzantium
				title = e_roman_empire
			}
			has_law = succ_byzantine_elective
		}
	}
	
	immediate = {
		join_society = roman_administration_imperial_court
		set_society_grandmaster = yes
		change_society_currency = 500
		any_realm_character = {
			limit = {
				roman_administration_can_join_society = yes
			}
			join_society = roman_administration_imperial_court
		}
		any_vassal = {
			limit = {
				roman_administration_can_join_society = yes
			}
			join_society = roman_administration_imperial_court
		}
	}		
	
}		

## Terms of office timer set up
character_event = {	
	id = AVE_MARIA_roman_administration.4
	border = GFX_event_normal_frame_diplomacy		
	desc = AVE_MARIA_roman_administration.4
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		primary_title = {
			roman_administration_administrative_title_trigger = yes
		}
	}
		
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = roman_administration_term_duration_count
					value <= 0
				}
			}
			set_variable = {
				which = roman_administration_term_duration_count
				value = 0
			}			
		}		
	}		
	
}

## Terms of office timer count for each year
character_event = {	
	id = AVE_MARIA_roman_administration.5
	border = GFX_event_normal_frame_diplomacy		
	desc = AVE_MARIA_roman_administration.5
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		check_variable = {
			which = roman_administration_term_duration_count
			value >= 0
		}
	}
		
	immediate = {		
		change_variable = {
			which = roman_administration_term_duration_count
			value = 1
		}
	}		
	
}

## Terms of office terminado
character_event = {
	id = AVE_MARIA_roman_administration.6
	border = GFX_event_normal_frame_diplomacy		
	desc = AVE_MARIA_roman_administration.6
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		check_variable = {
			which = roman_administration_term_duration_count
			value = 6
		}
	}
		
	immediate = {		
		abdicate = yes
	}		
	
}		
	
## Test test
character_event = {
	id = AVE_MARIA_roman_administration.7
	border = GFX_event_normal_frame_diplomacy		
	desc = AVE_MARIA_roman_administration.7
	hide_window = yes
	
	is_triggered_only = yes
	
	
	immediate = {
		## Family titular title doling out set up
		d_abydos = {						
			holder_scope = {
				set_character_flag = wtf
				if = {				
					limit = {			
						liege = {
							character = ROOT
						}	
					}
					set_character_flag = wtfxxx
					grant_title_no_opinion = c_roman_family_3
					# d_roman_family_3 = { gain_title = THIS }			
				}				
			}					
		}
	}
}